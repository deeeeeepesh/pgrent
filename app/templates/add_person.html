{% extends "base.html" %}
{% block content %}
<h2>Add Person</h2>
<form method="post" action="/person/add">
  <input name="name" placeholder="Name" required><br>
  <input name="id_proof" placeholder="ID proof (text)"><br>

  <!-- Room dropdown -->
  <select name="room_id" id="room_select" onchange="loadBeds()" required>
    <option value="">Select room</option>
    {% for r in rooms %}
      <option value="{{r.id}}">{{r.name}}</option>
    {% endfor %}
  </select><br>

  <!-- Bed dropdown (populated dynamically) -->
  <select name="bed_id" id="bed_select" required>
    <option value="">Select bed</option>
  </select><br>

  <input name="base_rent" placeholder="Base rent" type="number" step="0.01" required><br>
  <button type="submit">Add</button>
</form>

<script>
async function loadBeds(){
  const rid = document.getElementById('room_select').value;
  const sel = document.getElementById('bed_select');
  sel.innerHTML = '<option value="">Loadingâ€¦</option>';

  if(!rid){
    sel.innerHTML = '<option value="">Select bed</option>';
    return;
  }

  try {
    const res = await fetch(`/api/room/${rid}/beds`);
    const beds = await res.json();

    sel.innerHTML = '';
    if(beds.length === 0){
      sel.innerHTML = '<option value="">No vacant beds</option>';
    } else {
      beds.forEach(b => {
        const opt = document.createElement('option');
        opt.value = b.id;
        opt.textContent = `Bed ${b.number}`;
        sel.appendChild(opt);
      });
    }
  } catch (err){
    sel.innerHTML = '<option value="">Error loading beds</option>';
  }
}
</script>
{% endblock %}
